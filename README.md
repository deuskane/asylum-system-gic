**Table Of Contents**
- **Introduction**: Short description of this repository and purpose.
- **HDL Modules**: Per-module description, generics and ports.
- **Register Map (CSR)**: CSR register list with links to registers and bitfields.
- **Verification**: Notes about simulation and the Fusesoc core file.

**Introduction**
- **Repository**: `asylum-system-gic` provides a small General Interrupt Controller (GIC) implementation in VHDL.
- **Location of sources**: HDL sources are in `hdl/`. CSR definitions and generated files are in `hdl/csr/`.
- **Purpose**: Provide a lightweight GIC with a simple software-visible register map (ISRs, IMRs) and an SBI-compatible interface.

**HDL Modules**
- **Module folder**: `hdl/`

Below are the modules present in `hdl/` with their generics (if any) and port descriptions.

**GIC_core** (`hdl/GIC_core.vhd`)
- **Description**: Core combinational logic that computes interrupt status and merged interrupt output from inputs, mask and status registers.

Generics

| Name | Type | Default | Description |
|------|------|---------|-------------|
| *(none)* | | | This entity defines no generics |

Ports

| Name | Direction | Type | Description |
|------|-----------|------|-------------|
| `itm_o` | out | `std_logic` | Merged interrupt output (single-bit interrupt) |
| `its_i` | in  | `std_logic_vector` | Interrupt inputs vector (raw interrupt lines) |
| `isr_i` | in  | `std_logic_vector` | Current Interrupt Status Register (from CSR) |
| `isr_o` | out | `std_logic_vector` | Next Interrupt Status Register (to CSR logic) |
| `imr_i` | in  | `std_logic_vector` | Interrupt Mask Register (from CSR) |

Notes: The component reduces the active ISR bits into `itm_o` using a logical OR and computes the next ISR value combining mask and inputs.

**it_ctrl** (`hdl/it_ctrl.vhd`)
- **Description**: Simple edge-detection and handshake for a single interrupt line. Produces a sticky `it_val_o` until acknowledged.

Generics

| Name | Type | Default | Description |
|------|------|---------|-------------|
| *(none)* | | | This entity defines no generics |

Ports

| Name | Direction | Type | Description |
|------|-----------|------|-------------|
| `clk_i` | in  | `std_logic` | Clock input |
| `arstn_i` | in  | `std_logic` | Asynchronous reset (active low) |
| `it_i` | in  | `std_logic` | Raw interrupt input |
| `it_val_o` | out | `std_logic` | Valid/sticky interrupt output (set on rising edge until ack) |
| `it_ack_i` | in  | `std_logic` | Acknowledge input to clear `it_val_o` |

**sbi_GIC** (`hdl/sbi_GIC.vhd`)
- **Description**: Top-level integration wrapper that instantiates the CSR register block (`GIC_registers`) and `GIC_core`. Exposes an SBI-compatible bus interface and the interrupt interface.

Generics

| Name | Type | Default | Description |
|------|------|---------|-------------|
| *(none)* | | | This entity defines no generics |

Ports

| Name | Direction | Type | Description |
|------|-----------|------|-------------|
| `clk_i` | in | `std_logic` | Clock input |
| `arst_b_i` | in | `std_logic` | Asynchronous reset (active low) |
| `sbi_ini_i` | in | `sbi_ini_t` | Bus initiator interface (SBI) |
| `sbi_tgt_o` | out | `sbi_tgt_t` | Bus target interface (SBI) |
| `its_i` | in | `std_logic_vector` | Interrupt inputs vector (forwarded to GIC_core) |
| `itm_o` | out | `std_logic` | Merged interrupt output (from GIC_core) |

**GIC_pkg** (`hdl/GIC_pkg.vhd`)
- **Description**: Package declaring component interfaces and record/array types used by the GIC family (`it_ini_t`, `it_tgt_t`, arrays, and component declarations for `it_ctrl`, `GIC_core`, `sbi_GIC`).

Generics

| Name | Type | Default | Description |
|------|------|---------|-------------|
| *(none)* | | | Package file, not an entity |

Ports

| *(not applicable)* | | | `GIC_pkg` exports types and component declarations for use by other modules |

**Register Map (CSR)**
- **CSR folder**: `hdl/csr/`
- **Primary files**: `hdl/csr/GIC.hjson`, `hdl/csr/GIC_csr.md`, `hdl/csr/GIC_csr.vhd`, `hdl/csr/GIC_csr.h`.
- **Generated by**: The project `GIC.core` uses the `regtool` generator (see `GIC.core`) to produce CSR HDL and header artifacts from `hdl/csr/GIC.hjson`.

Registers

| Address | Register | Access | Link |
|---------|----------|--------|------|
| `0x0` | `isr` | `swaccess: rw1c`, `hwaccess: rw` | [isr - CSR doc](hdl/csr/GIC_csr.md#0x0-isr) |
| `0x1` | `imr` | `swaccess: rw`, `hwaccess: ro` | [imr - CSR doc](hdl/csr/GIC_csr.md#0x1-imr) |

Bitfields (click to open CSR markdown)

| Register | Field | Bits | Description | Link |
|----------|-------|------|-------------|------|
| `isr` | `value` | [7:0] | 0: inactive, 1: active | [isr.value](hdl/csr/GIC_csr.md#7-0-value) |
| `imr` | `enable` | [7:0] | 0: disabled, 1: enabled | [imr.enable](hdl/csr/GIC_csr.md#7-0-enable) |
